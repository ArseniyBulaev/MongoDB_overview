 db.students.aggregate([
  { $unwind: "$grades" },
  { $lookup: { from: "courses", localField: "grades.course_id", foreignField: "_id", as: "courses_info" } },
  { $project: { _id: 0 , course_name: "$courses_info.name", course_grade: "$grades.grade" }},
  { $unwind: "$course_name" },
  { $group: { _id: "$course_name", average_score:{$avg: "$course_grade"}}}])